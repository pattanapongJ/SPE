<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="pos_invoice_preprint_report_document">
        <t t-if="not o and doc">
            <t t-set="o" t-value="doc"/>
        </t>
        <t t-if="o and 'company_id' in o">
            <t t-set="company" t-value="o.company_id.sudo()"/>
        </t>
        <t t-if="not o or not 'company_id' in o">
            <t t-set="company" t-value="res_company"/>
        </t>
        <div class="header" style="font-family: Kanit; font-size: 14px">
            <div style="">
                <div class="d-flex" style="margin-left: 5%;">
                    <div style="margin-top: 100px; width: 70%;">
                        <t t-if="doc.ref">
                            <span t-field="doc.ref"/>
                        </t>
                        <t t-else="">
                            <span style="color: white">-</span>
                        </t>
                    </div>
                    <div class="d-flex" style="margin-top: 100px;">
                        <span>Page </span>
                        <span class="page"/>
                        /
                        <span class="topage"/>
                    </div>
                </div>
                <div style="margin-top: 5px; margin-left: 100px;">
                    <t t-if="doc.partner_id.ref">
                        <span t-field="doc.partner_id.ref"/>
                    </t>
                    <t t-else="">
                        <span style="color: white">-</span>
                    </t>
                </div>
                <div class="d-flex" style="margin-left: 70%">
                    <!-- <p style="padding: 0px; margin-right: 30px;">[3] - Billing Route</p> -->
                    <p style="padding: 0px; margin-right: 50px;">
                        <t t-if="doc.billing_route_id.name">
                            <span t-field="doc.billing_route_id.name"/>
                        </t>
                        <t t-else="">
                            <span style="color: white">-</span>
                        </t>
                    </p>
                    <t t-if="doc.form_no">
                        <span t-field="doc.form_no"/>
                    </t>
                    <t t-else="">
                        <span style="color: white">-</span>
                    </t>
                </div>
                <div class="d-flex" style="margin-left: 70%">
                    <p style="padding: 0px; margin-right: 50px;">
                        <t t-if="doc.billing_route_id.name">
                            <span t-esc="doc.billing_route_id.name"/>
                        </t>
                        <t t-else="">
                            <span style="color: white">-</span>
                        </t>
                    </p>
                    <!-- <span t-field="doc.form_no"/>[ตัด] -->
                </div>
                <div class="d-flex" style="margin-left: 10%; position: relative; top: 19px;">
                    <div style="margin-right: 10px; ">
                        <t t-if="doc.partner_id.name">
                            <span t-field="doc.partner_id.name"/>
                        </t>
                        <t t-else="">
                            <span style="color: white">-</span>
                        </t>
                    </div>
                    <div style="margin-right: 45%;width: 87px;">
                        <t t-if="doc.partner_id.branch_name">
                            <span t-field="doc.partner_id.branch_name"/>
                        </t>
                        <t t-else="">
                            <span style="color: white">-</span>
                        </t>
                    </div>
                    <div style="padding: 0px; margin: 0px;">
                        <t t-if="doc.invoice_date_due">
                            <span style="position: relative; top: 3px;" t-field="doc.invoice_date_due"/>
                        </t>
                        <t t-else="">
                            <span style="color: white;position: relative; top: 3px;">-</span>
                        </t>
                    </div>
                    <!-- <p>09/05/2024???</p> -->
                </div>
                <div class="d-flex">
                    <div class="d-flex" style="margin-left: 90px;width: 400px;position: relative; top: 19px;">
                        <span t-field="doc.partner_id.street"/>
                        <span t-field="doc.partner_id.street2"/>
                        <span t-field="doc.partner_id.sub_district"/>
                    </div>
                    <div style="text-align: right;">
                        <t t-if="doc.sale_spec_employee.name">
                            <span style="position: relative; top: 12px;" t-field="doc.sale_spec_employee.name"/>
                        </t>
                        <t t-else="">
                            <span style="color: white;position: relative; top: 12px;">-</span>
                        </t>
                    </div>
                </div>
                <div class="d-flex">
                    <div class="d-flex" style="margin-right: 30%; width: 400px;position: relative; top: 19px;">
                        <span t-field="doc.partner_id.city"/>
                        <span t-field="doc.partner_id.state_id"/>
                        <span t-field="doc.partner_id.zip"/>
                    </div>
                    <!--<div style="padding: 0px; margin: 0px">-->
                    <!--    <t t-if="doc.invoice_date_due">-->
                    <!--        <span style="position: relative; top: -25px;"  t-field="doc.invoice_date_due"/>-->
                    <!--    </t>-->
                    <!--    <t t-else="">-->
                    <!--        <span style="color: white;position: relative; top: -15px;">-</span>-->
                    <!--    </t>-->
                    <!--</div>-->
                    <div style="padding: 0px; margin: 0px">
                        <t t-if="doc.invoice_user_employee_id.name">
                            <span style="position: relative; top: 26px;" t-field="doc.invoice_user_employee_id.name"/>/
                            <span t-field="doc.invoice_user_employee_id.phone"/>
                        </t>
                        <t t-else="">
                            <span style="position: relative; top: 26px;color: white">-</span>
                        </t>
                    </div>
                </div>
                <div class="d-flex" style="margin-left: 87%;">
                    <t t-if="doc.partner_id.vat">
                        <span style="position: relative; top: 73px" t-field="doc.partner_id.vat"/>
                    </t>
                    <t t-else="">
                        <span style="position: relative; top: 73px">-</span>
                    </t>
                </div>
                <div class="d-flex" style="">
                    <div style="margin-right: 10px;">
                        <t t-if="doc.partner_id.phone">
                            <span t-field="doc.partner_id.phone"/>
                        </t>
                        <t t-else="">
                            <span style="color: white">-</span>
                        </t>
                    </div>
                    <div style="margin-right: 65%;">
                        <t t-if="doc.partner_id.fax">
                            <span t-field="doc.partner_id.fax"/>
                        </t>
                        <t t-else="">
                            <span style="color: white">-</span>
                        </t>
                    </div>
                    <!-- <span t-field="doc.invoice_payment_term_id.name"/>[e] -->
                    <t t-if="doc.invoice_date_due">
                        <span style="color: white;position: relative; top: 40px;" t-field="doc.invoice_date_due"/>
                    </t>
                    <t t-else="">
                        <span style="color: white;position: relative; top: 40px;">-</span>
                    </t>
                </div>
            </div>
        </div>
        <div class="article" style="font-family: Kanit; border: 2px solid white;">
            <style>
            thead th {
              height: 62px;
            }
          </style>
            <div>
                <t t-set="l_no" t-value="0"/>
                <table class="table table-borderless" style="font-size: 12.67px;line-height: 10px; margin-top:5px;">
                    <thead style="height: 30px">
                        <tr>
                            <th class="text-center" style="width: 3%;color: white">1</th>
                            <th class="text-center" style="width: 50%;color: white">2</th>
                            <th class="text-center" style="width: 5%;color: white">3</th>
                            <th class="text-center" style="width: 10%;color: white">4</th>
                            <th class="text-center" style="width: 4%;color: white">5</th>
                            <th class="text-center" style="width: 12%;color: white">6</th>
                            <th class="text-center" style="width: 16%;color: white">7</th>
                        </tr>
                    </thead>
                    <tbody style="font-size: 12.67px">
                        <t t-foreach="doc.invoice_line_ids.sorted(key=lambda l: l.sequence)" t-as="ol">
                            <!-- กรณีบรรทัดประเภทหัวข้อ/หมายเหตุ -->
                            <t t-if="ol.display_type in ['line_section', 'line_note']">
                                <tr>
                                    <td/>
                                    <td colspan="6" class="text-left">
                                        <t t-if="ol.display_type == 'line_note'">
                                            <em>
                                                <span t-field="ol.name"/>
                                            </em>
                                        </t>
                                        <t t-elif="ol.display_type == 'line_section'">
                                            <strong>
                                                <span t-field="ol.name"/>
                                            </strong>
                                        </t>
                                        <t t-else="">
                                            <span>-</span>
                                        </t>
                                    </td>
                                </tr>
                            </t>
                            <!-- กรณีบรรทัดสินค้าปกติ -->
                            <t t-else="">
                                <tr>
                                    <td class="text-center">
                                        <t t-if="not ol.is_component">
                                            <t t-set="l_no" t-value="l_no + 1"/>
                                            <t t-esc="l_no"/>
                                        </t>
                                    </td>
                                    <!-- คอลัมน์ชื่อสินค้า ตาม form_label_type -->
                                    <t t-if="doc.form_label_type == 'label'">
                                        <td class="text-left">
                                            <span t-if="ol.name">
                                                <span t-field="ol.name"/></span>
                                            <span t-if="not ol.name">-</span>
                                        </td>
                                    </t>
                                    <t t-elif="doc.form_label_type == 'name'">
                                        <td class="text-left">
                                            <span t-if="ol.product_id.name">
                                                <span t-field="ol.product_id.name"/></span>
                                            <span t-if="not ol.product_id.name">-</span>
                                        </td>
                                    </t>
                                    <t t-elif="doc.form_label_type == 'ref_name'">
                                        <td class="text-left">
                                            <span t-field="ol.product_id.default_code"/>
                                            <span t-field="ol.name"/>
                                        </td>
                                    </t>
                                    <t t-elif="doc.form_label_type == 'barcode_name'">
                                        <td class="text-left">
                                            <span t-field="ol.product_id.barcode"/>
                                            <span t-field="ol.name"/>
                                        </td>
                                    </t>
                                    <t t-elif="doc.form_label_type == 'external_code_name'">
                                        <t t-set="filtered_barcodes" t-value="ol.product_id.product_tmpl_id.barcode_spe_ids.filtered(lambda b: b.partner_id == doc.partner_id and b.product_tmpl_id == ol.product_id.product_tmpl_id)"/>
                                        <td class="text-left">
                                            <t t-if="filtered_barcodes">
                                                <t t-foreach="filtered_barcodes" t-as="barcode1">
                                                    <span t-field="barcode1.external_code"/>
                                                    <span t-field="barcode1.external_description"/>
                                                </t>
                                                <!--<span t-field="ol.external_description"/>-->
                                            </t>
                                            <t t-else="">-</t>
                                        </td>
                                    </t>
                                    <t t-elif="doc.form_label_type == 'external_desc_name'">
                                        <t t-set="filtered_barcodes" t-value="ol.product_id.product_tmpl_id.barcode_spe_ids.filtered(lambda b: b.partner_id == doc.partner_id and b.product_tmpl_id == ol.product_id.product_tmpl_id)"/>
                                        <td class="text-left">
                                            <t t-if="filtered_barcodes">
                                                <t t-foreach="filtered_barcodes" t-as="barcode1">
                                                    <span t-field="barcode1.external_description"/>
                                                </t>
                                                <span t-field="ol.name"/>
                                            </t>
                                            <t t-else="">-</t>
                                        </td>
                                    </t>
                                    <t t-else="">
                                        <td class="text-left">
                                            <span t-if="ol.name">
                                                <span t-field="ol.product_id.default_code"/>
                                                <span t-field="ol.name"/></span>
                                            <span t-if="not ol.name">-</span>
                                        </td>
                                    </t>
                                    <td class="text-left text-nowrap" style="position:relative; left: 3px;">
                                        <span style="display:inline-block; width:47px; text-align:left;">
                                            <t t-esc="(ol.triple_discount or '').replace('+', ',')"/>
                                        </span>
                                    </td>
                                    <td class="text-right" style="position:relative; left:-7px;">
                                        <t t-if="ol.quantity">
                                            <t t-set="qty" t-value="float(ol.quantity)"/>
                                            <t t-if="qty.is_integer()">
                                                <!-- เป็นจำนวนเต็ม เช่น 10.00 => แสดง 10 -->
                                                <span t-esc="'{:,.0f}'.format(qty)"/>
                                            </t>
                                            <t t-else="">
                                                <!-- มีทศนิยม เช่น 10.30 => แสดง 10.30 -->
                                                <span t-esc="'{:,.2f}'.format(qty)"/>
                                            </t>
                                        </t>
                                        <t t-else="">
                                            <span>-</span>
                                        </t>
                                    </td>
                                    <td class="text-right">
                                        <span t-if="ol.product_uom_id.name">
                                            <span t-field="ol.product_uom_id.name"/></span>
                                        <span t-if="not ol.product_uom_id.name">-</span>
                                    </td>
                                    <td class="text-right">
                                        <span t-if="ol.price_unit">
                                            <span t-esc="'{:,.4f}'.format(float(ol.price_unit))"/></span>
                                        <span t-if="not ol.price_unit">-</span>
                                    </td>
                                    <td class="text-right">
                                        <span t-if="ol.price_subtotal">
                                            <span t-esc="'{:,.2f}'.format(float(ol.price_subtotal))" style="margin-right:3px;"/></span>
                                        <span t-if="not ol.price_subtotal" style="margin-right:3px;">-</span>
                                    </td>
                                </tr>
                            </t>
                        </t>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="footer last-page" style="font-size: 12.67px">
            <div class="" style="">
                <div class="d-flex" style="">
                    <t t-if="doc.transport_line_id.name">
                        <span t-field="doc.transport_line_id.name"/>
                    </t>
                    <t t-else="">
                        <span style="color: white">-</span>
                    </t>
                </div>
                <div class="d-flex justify-content-end" style="width: fit-content; margin-top:30px; margin-right: 10px;">
                    <div style="                 width: 600px;                 position: relative;                 top: -47px;                 display: -webkit-box;                 -webkit-line-clamp: 3;                 -webkit-box-orient: vertical;                 overflow: hidden;                 text-overflow: ellipsis;                 white-space: normal;">
                        <t t-if="doc.narration">
                            <span t-field="doc.narration"/>
                        </t>
                        <t t-else="">
                            <span style="color: white">-</span>
                        </t>
                    </div>
                    <div style="margin-left: 100px; position: relative; top: -15px;">
                        <t t-if="doc.amount_untaxed">
                            <span t-esc="'{:,.2f}'.format(float(doc.amount_untaxed))"/>
                        </t>
                        <t t-else="">
                            <span style="color: white">-</span>
                        </t>
                    </div>
                </div>
                <div class="row" style="margin-bottom: 2mm; margin-right: 10px;">
                    <div style="width: 70%; text-align: right;">
                        <t t-if="doc.invoice_line_ids">
                            <t t-if="doc.invoice_line_ids[0].tax_ids">
                                <div style="margin-right: -94px; display: inline-block;">
                                    <span t-field="doc.invoice_line_ids[0].tax_ids.amount" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 0}"/>%
                                </div>
                            </t>
                            <t t-else="">
                                <span style="color: white;margin-right: -94px; display: inline-block">-</span>
                            </t>
                        </t>
                    </div>
                    <div style="width: 30%;">
                        <table style="width: 100%; text-align: right;">
                            <tr>
                                <td style="width: 100px; text-align: right;">
                                    <t t-set="amount_by_group" t-value="doc.amount_by_group"/>
                                    <t t-if="amount_by_group and len(amount_by_group) &gt; 0 and len(amount_by_group[0]) &gt; 1">
                                        <t t-if="amount_by_group[0][1]">
                                            <t t-set="value" t-value="amount_by_group[0][1]"/>
                                            <t t-if="value is not None">
                                                <span t-esc="'{:,.2f}'.format(float(value))"/>
                                            </t>
                                            <t t-else="">
                                                <span>-</span>
                                            </t>
                                        </t>
                                        <t t-if="not amount_by_group[0][1]">
                                            <span>-</span>
                                        </t>
                                    </t>
                                    <t t-else="">
                                        <span>-</span>
                                    </t>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="d-flex justify-content-center" style="margin-right: 10px;">
                    <div style="padding: 10px 30px 10px 30px;">
                        <t t-if="doc.currency_id.amount_to_text_th(abs(doc.amount_residual), o.currency_id.currency_unit_label)">
                            <span style="position: relative; top: 5px;font-size: 15px" t-esc="doc.currency_id.amount_to_text_th(abs(doc.amount_residual), o.currency_id.currency_unit_label)"/>
                        </t>
                        <t t-else="">
                            <span style="color: white; position: relative; top: 20px;">-</span>
                        </t>
                    </div>
                    <div>
                        <t t-if="doc.amount_residual">
                            <span style="color: white" t-esc="'{:,.2f}'.format(float(doc.amount_residual))"/>
                        </t>
                        <t t-else="">
                            <span style="color: white">-</span>
                        </t>
                    </div>
                </div>
                <div class="d-flex justify-content-end" style="">
                    <div>
                        <t t-if="doc.amount_residual">
                            <span style="position: relative; top: -26px; margin-right: 10px;" t-esc="'{:,.2f}'.format(float(doc.amount_residual))"/>
                        </t>
                        <t t-else="">
                            <span style="color: white;position: relative; top: -14px; margin-right: 10px;">-</span>
                        </t>
                    </div>
                </div>
                <div class="d-flex justify-content-end" style="position: relative; top: -2px; margin-right: 10px;">
                    <t t-if="doc.billing_period_id.name">
                        <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px;">
                    BL:
                            <span t-field="doc.billing_period_id.name"/>
                </span>
                    </t>
                    <t t-else="">
                        <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px;">
                    BL:
                            <span style="color: white">-</span>
                        </span>
                    </t>
                </div>
                <div class="d-flex justify-content-end" style="">
                    <span style="color: white">-</span>
                </div>
                <div style="margin-left: 45%; position: relative; top: -57px;">
                    <t t-if="doc.name">
                        <span t-esc="doc.name"/>
                    </t>
                    <t t-else="">
                        <span style="color: white">-</span>
                    </t>
                </div>
                <br/>
                <div style="width: 100%;">
                    <div style="margin-left: 45%;">
                        <t t-if="doc.create_uid">
                            <span style="position: relative; top: -66px;" t-field="doc.create_uid"/>
                        </t>
                        <t t-else="">
                            <span style="color: white; position: relative; top: -41px;">-</span>
                        </t>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <template id="pos_invoice_preprint_report">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="hdc_account_general_reports.pos_invoice_preprint_report_document" t-lang="doc.partner_id.lang"/>
            </t>
        </t>
    </template>
</odoo>