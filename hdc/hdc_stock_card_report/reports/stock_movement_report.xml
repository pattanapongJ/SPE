<odoo>

    <template
        id="assets_backend"
        name="hdc_stock_movement_report assets"
        inherit_id="web.assets_backend"
    >
        <xpath expr="." position="inside">
            <link
                href="/hdc_stock_card_report/static/src/css/report.css"
                rel="stylesheet"
            />
            <script
                type="text/javascript"
                src="/hdc_stock_card_report/static/src/js/stock_card_report_backend.js"
            />
        </xpath>
    </template>

    <template id="hdc_stock_card_report.stock_movement_internal_layout">
        <div class="article">
            <link
                href="/hdc_stock_card_report/static/src/css/report.css"
                rel="stylesheet"
            />
            <t t-raw="0" />
        </div>
        <div class="footer">
            <div class="row">
                <div class="col-6 custom_footer">
                    <span
                        t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d')"
                    />
                </div>
                <div class="col-6 text-right custom_footer">
                    <span class="page" />/<span class="topage" />
                </div>
            </div>
        </div>
    </template>

    <template id="report_stock_movement_buttons">
        <div class="button_row">
            <!-- <button class="o_stock_card_reports_print btn btn-sm oe_button"><span
                    class="fa fa-print"
                />Print</button> -->
            <button class="o_stock_card_reports_export btn btn-sm oe_button"><span
                    class="fa fa-download"
                />Export</button>
        </div>
    </template>

    <template id="report_stock_movement_report_html">
        <div class="o_stock_card_reports_page">
            <t t-call="hdc_stock_card_report.report_stock_movement_buttons" />
            <t t-call="hdc_stock_card_report.report_stock_movement_report_base" />
        </div>
    </template>

    <template id="hdc_stock_card_report.report_stock_movement_report_pdf">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="hdc_stock_card_report.internal_layout">
                    <t t-call="hdc_stock_card_report.report_stock_movement_report_base" />
                </t>
            </t>
        </t>
    </template>

    <template id="hdc_stock_card_report.report_stock_movement_report_base">        
            <div class="page">  
                <div class="row">
                    <t t-set="title">รายงานการเคลื่อนไหวของสินค้า (Stock Movement Report)</t>     
                    <h4 class="mt0" t-esc="title" style="text-align: center;" />
                </div>    
                <!-- Display filters -->
                <t t-call="hdc_stock_card_report.report_stock_movement_report_filters" />
                <!-- Display stock card table -->
                <div class="act_as_table data_table mt4" style="width: 100%;">
                    <!-- Display header line-->
                    <t t-call="hdc_stock_card_report.report_stock_movement_lines_header" />
                    <!-- Display each lines -->
                    <t t-set="first_product" t-value="1"/>
                    <t t-set="check_product" t-value=""/>
                    <t t-set="internal_total_qty" t-value="0"/>
                    <t t-set="transit_total_qty" t-value="0"/>
                    <t t-set="amount_total" t-value="0"/>
                    <t t-set="grand_uom_name" t-value=""/>
                    <t t-set="number" t-value="0"/>
                    <t t-set="before_total_sum" t-value=""/>
                    <t t-set="in_total" t-value="0"/>
                    <t t-set="out_total" t-value="0"/>
                    <t t-foreach="o.results" t-as="product_line">
                        <t t-if="product_line.product_id != check_product">
                            <t t-set="check_product" t-value="product_line.product_id"/>
                            <t t-if="first_product != 1">
                                <div class="act_as_row lines">
                                    <div class="act_as_cell"></div>
                                    <div class="act_as_cell"></div>
                                    <div class="act_as_cell"></div>
                                    <div class="act_as_cell"></div>
                                    <div class="act_as_cell"></div>
                                    <div class="act_as_cell"></div>
                                    <div class="act_as_cell"></div>
                                    <div class="act_as_cell"></div>
                                    <div class="act_as_cell"></div>
                                    <div class="act_as_cell left" style="background-color:#92D050;"><b>TOTAL</b></div>
                                    <div class="act_as_cell"></div>
                                    <div class="act_as_cell right">
                                        <t t-if="internal_total_qty">
                                            <t t-esc="'{0:,.2f}'.format(internal_total_qty)"/>
                                        </t>
                                        <t t-if="not internal_total_qty">
                                            -
                                        </t>        
                                    </div>
                                    <div class="act_as_cell right">
                                        <t t-if="transit_total_qty">
                                            <t t-esc="'{0:,.2f}'.format(transit_total_qty)"/>
                                        </t>
                                        <t t-if="not transit_total_qty">
                                            -
                                        </t>        
                                    </div>
                                    <div class="act_as_cell right">
                                        <t t-if="amount_total">
                                            <t t-esc="'{0:,.2f}'.format(amount_total)"/>
                                        </t>
                                        <t t-if="not amount_total">
                                            -
                                        </t>        
                                    </div>
                                    <div class="act_as_cell left">
                                        <t t-if="grand_uom_name">
                                            <t t-esc="grand_uom_name"/>
                                        </t>
                                        <t t-if="not grand_uom_name">
                                            -
                                        </t>   
                                    </div>
                                </div>
                                <t t-set="internal_total_qty" t-value="0"/>
                                <t t-set="transit_total_qty" t-value="0"/>
                            </t>
                            <t t-if="first_product == 1">
                                <t t-set="first_product" t-value="0"/>
                            </t>
                            <div class="act_as_row lines">
                                <div class="act_as_cell right" style="background-color:#9FC5e8;"></div>
                                <div class="act_as_cell left" style="background-color:#9FC5e8;"></div>
                                <div class="act_as_cell left" style="background-color:#9FC5e8;"></div>
                                <div class="act_as_cell left" style="background-color:#9FC5e8;"></div>
                                <div class="act_as_cell left" style="background-color:#9FC5e8;"></div>
                                <div class="act_as_cell left" style="background-color:#9FC5e8;"></div>
                                <div class="act_as_cell left" style="background-color:#9FC5e8;"></div>
                                <div class="act_as_cell left" style="background-color:#9FC5e8;"></div>
                                <div class="act_as_cell left" style="background-color:#9FC5e8;">
                                    <t t-esc="product_line.product_id.name"/>
                                </div>
                                <div class="act_as_cell right" style="background-color:#9FC5e8;">
                                    <!-- <t t-esc="'{0:,.2f}'.format(product_line.cost_unit_price)"/> -->
                                </div>
                                <div class="act_as_cell right" style="background-color:#9FC5e8;">
                                    <t t-esc="'{0:,.2f}'.format(product_line.qty_available)" />
                                </div>
                                <div class="act_as_cell right" style="background-color:#9FC5e8;"></div>
                                <div class="act_as_cell right" style="background-color:#9FC5e8;"></div>
                                <div class="act_as_cell right" style="background-color:#9FC5e8;"></div>
                                <div class="act_as_cell left" style="background-color:#9FC5e8;"></div>
                            </div>
                        </t>
                        <t t-if="product_line.product_id == check_product">
                            <div class="act_as_row lines">
                                <div class="act_as_cell right">
                                    <t t-set="number" t-value="number + 1"/>
                                    <t t-esc="number"/>
                                </div>
                                <div class="act_as_cell left">
                                    <t t-esc="product_line.warehouse_id.name"/>
                                </div>
                                <div class="act_as_cell left">
                                    <t t-esc="product_line.pd_type_name"/>
                                </div>
                                <div class="act_as_cell left">
                                    <t t-esc="product_line.categ_id.complete_name"/>
                                </div>
                                <div class="act_as_cell left">
                                    <t t-esc="product_line.origin"/>
                                </div>
                                <div class="act_as_cell left">
                                    <t t-esc="product_line.reference"/>
                                </div>
                                <div class="act_as_cell left">
                                    <t t-esc="product_line.date"/>
                                </div>
                                <div class="act_as_cell left">
                                    <t t-esc="product_line.default_code"/>
                                </div>
                                <div class="act_as_cell left">
                                    <t t-esc="product_line.product_id.name"/>
                                </div>
                                <div class="act_as_cell right">
                                    <t t-esc="'{0:,.2f}'.format(product_line.cost_unit_price)"/>
                                </div>
                                <div class="act_as_cell right">
                                    
                                </div>
                                <div class="act_as_cell right">
                                    <t t-esc="'{0:,.2f}'.format(product_line.qty_in)" />
                                    <t t-set="internal_total_qty" t-value="internal_total_qty + product_line.qty_in"/>
                                    <t t-set="in_total" t-value="in_total + product_line.qty_in"/>
                                </div>
                                <div class="act_as_cell right">
                                    <t t-esc="'{0:,.2f}'.format(product_line.qty_out)" />
                                    <t t-set="transit_total_qty" t-value="transit_total_qty + product_line.qty_out"/>
                                    <t t-set="out_total" t-value="out_total + product_line.qty_out"/>
                                </div>
                                <div class="act_as_cell right">
                                    <t t-esc="'{0:,.2f}'.format(product_line.amount_qty)" />
                                    <t t-set="amount_total" t-value="product_line.amount_qty"/>
                                </div>
                                <div class="act_as_cell left">
                                    <t t-esc="product_line.product_uom_id.name"/>
                                    <t t-set="grand_uom_name" t-value="product_line.product_uom_id.name"/>
                                </div>
                            </div> 
                        </t>
                    </t>
                    <div class="act_as_row lines">
                        <div class="act_as_cell"></div>
                        <div class="act_as_cell"></div>
                        <div class="act_as_cell"></div>
                        <div class="act_as_cell"></div>
                        <div class="act_as_cell"></div>
                        <div class="act_as_cell"></div>
                        <div class="act_as_cell"></div>
                        <div class="act_as_cell"></div>
                        <div class="act_as_cell"></div>
                        <div class="act_as_cell left" style="background-color:#92D050;"><b>TOTAL</b></div>
                        <div class="act_as_cell"></div>
                        <div class="act_as_cell right">
                            <t t-if="internal_total_qty">
                                <t t-esc="'{0:,.2f}'.format(internal_total_qty)"/>
                            </t>
                            <t t-if="not internal_total_qty">
                                -
                            </t>        
                        </div>
                        <div class="act_as_cell right">
                            <t t-if="transit_total_qty">
                                <t t-esc="'{0:,.2f}'.format(transit_total_qty)"/>
                            </t>
                            <t t-if="not transit_total_qty">
                                -
                            </t>        
                        </div>
                        <div class="act_as_cell right">
                            <t t-if="amount_total">
                                <t t-esc="'{0:,.2f}'.format(amount_total)"/>
                            </t>
                            <t t-if="not amount_total">
                                -
                            </t>        
                        </div>
                        <div class="act_as_cell left">
                            <t t-if="grand_uom_name">
                                <t t-esc="grand_uom_name"/>
                            </t>
                            <t t-if="not grand_uom_name">
                                -
                            </t>   
                        </div>
                    </div>
                    <div class="act_as_row lines">
                        <div class="act_as_cell_left" style="background-color:#white;">รวมทั้งสิ้น</div>
                        <div class="act_as_cell_top_bot" style="background-color:white;"></div>
                        <div class="act_as_cell_top_bot" style="background-color:white;"></div>
                        <div class="act_as_cell_top_bot" style="background-color:white;"></div>
                        <div class="act_as_cell_top_bot" style="background-color:white;"></div>
                        <div class="act_as_cell_top_bot" style="background-color:white;"></div>
                        <div class="act_as_cell_top_bot" style="background-color:white;"></div>
                        <div class="act_as_cell_top_bot" style="background-color:white;"></div>
                        <div class="act_as_cell_top_bot" style="background-color:white;"></div>
                        <div class="act_as_cell_right" style="background-color:white;"></div>
                        <div class="act_as_cell">
                            <t t-esc="'{0:,.2f}'.format(o.before_total_sum)"/>
                        </div>
                        <div class="act_as_cell">
                            <t t-esc="'{0:,.2f}'.format(in_total)"/>
                        </div>
                        <div class="act_as_cell">
                            <t t-esc="'{0:,.2f}'.format(out_total)"/>
                        </div>
                        <div class="act_as_cell"></div>
                        <div class="act_as_cell"></div>
                    </div>
                </div>
                <p style="page-break-before:always;" />
            </div>
    </template>

    <template id="hdc_stock_card_report.report_stock_movement_report_filters">
        <div class="act_as_table data_table" style="width: 100%;">
            <div class="act_as_row labels">
                <div class="act_as_cell">Date From</div>
                <div class="act_as_cell">Date To</div>
                <div class="act_as_cell">Warehouse</div>
            </div>
            <div class="act_as_row">
                <div class="act_as_cell">
                    <span t-field="o.date_from" />
                </div>
                <div class="act_as_cell">
                    <span t-field="o.date_to" />
                </div>
                <div class="act_as_cell">
                    <span t-field="o.warehouse_ids" />
                </div>
            </div>
        </div>
    </template>

    <template id="hdc_stock_card_report.report_stock_movement_lines_header">
        <div class="act_as_thead">
            <div class="act_as_row labels">
                <div class="act_as_cell_borderless"></div>
                <div class="act_as_cell_borderless"></div>
                <div class="act_as_cell_borderless"></div>
                <div class="act_as_cell_borderless"></div>
                <div class="act_as_cell_borderless"></div>
                <div class="act_as_cell_borderless"></div>
                <div class="act_as_cell_borderless"></div>
                <div class="act_as_cell_borderless"></div>
                <div class="act_as_cell_borderless"></div>
                <div class="act_as_cell_borderless"></div>
                <div class="act_as_cell">ยอดยกมา</div>
                <div class="act_as_cell">นำเข้า</div>
                <div class="act_as_cell">เบิกออก</div>
                <div class="act_as_cell_borderless"></div>
                <div class="act_as_cell_borderless"></div>
            </div>
            <div class="act_as_row labels">
                <div class="act_as_cell">ลำดับที่</div>
                <div class="act_as_cell">WH</div>
                <div class="act_as_cell">Product Type</div>
                <div class="act_as_cell">Product Category</div>
                <div class="act_as_cell">เลขที่เอกสาร</div>
                <div class="act_as_cell">เลขที่ออเดอร์</div>
                <div class="act_as_cell">วันนำเข้า ออก</div>
                <div class="act_as_cell">รหัสสินค้า</div>
                <div class="act_as_cell">ชื่อสินค้า</div>
                <div class="act_as_cell">Cost (THB/Unit)</div>
                <div class="act_as_cell">ปริมาณ</div>
                <div class="act_as_cell">ปริมาณ</div>
                <div class="act_as_cell">ปริมาณ</div>
                <div class="act_as_cell">คงเหลือ</div>
                <div class="act_as_cell">หน่วยนับ</div>
            </div>
        </div>
    </template>
</odoo>
