<?xml version="1.0"?>
<odoo>

    <record id="mrp_prd_view_tree" model="ir.ui.view">
        <field name="name">mrp pdr tree</field>
        <field name="model">mrp.pdr</field>
        <field name="arch" type="xml">
            <tree string="Product Design Request" >
                <field name="name" readonly="1"/>
                <field name="user_request"/>
                <field name="request_date"/>
            </tree>
        </field>
    </record>
    
    <record id="mrp_prd_view_form" model="ir.ui.view">
        <field name="name">mrp pdr view form</field>
        <field name="model">mrp.pdr</field>
        <field name="arch" type="xml">
            <form string="Product Design Request">
                <header>
                    <button name="action_confirme"      type="object" string="Confirmed"        class="oe_highlight"  attrs="{'invisible':[('state','!=','draft')]}"/>
                    <button name="action_to_approve"    type="object" string="To Approve"       class="oe_highlight"  attrs="{'invisible':[('state','!=','confirmed')]}"/>
                    <button name="action_approved"      type="object" string="Approved"         class="oe_highlight"  attrs="{'invisible':[('state','!=','waiting_approve')]}"/>
                    <button name="action_revise"        type="object" string="Revise"           class="oe_highlight"  attrs="{'invisible':[('state','!=','waiting_approve')]}"/>
                    <button name="action_create_product_confirm"     type="object" string="Create New Product"   class="oe_highlight"  attrs="{'invisible':[('state','!=','new_product')]}"/>
                    <button name="action_create_mr"     type="object" string="Create New MR"    class="oe_highlight"  attrs="{'invisible':['|',('state','!=','done'),('mr_count','!=',0)]}"/>
                    <button name="action_set_to_draft"  type="object" string="Cancel"           attrs="{'invisible':[('state', 'in', ['done','cancel','new_product'])]}"/>
                    
                    <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,waiting_approve,new_product,done"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" name="action_mo_ids" type="object" icon="fa-bars" attrs="{'invisible': [('so_count', '=', 0)]}">
                            <field name="so_count" widget="statinfo" string="Quotation"/>
                        </button>
                        <button class="oe_stat_button" name="action_delivery_ids" type="object" icon="fa-dropbox" attrs="{'invisible': [('product_count', '=', 0)]}">
                            <field name="product_count" widget="statinfo" string="New Product"/>
                        </button>
                        <button class="oe_stat_button" name="action_mr_ids" type="object" icon="fa-bars" attrs="{'invisible': [('mr_count', '=', 0)]}">
                            <field name="mr_count" widget="statinfo" string="MRP Request"/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="user_request" attrs="{'readonly':[('state','not in',['draft','confirmed'])]}"/>
                            <field name="partner_id" options='{"no_create": True}' attrs="{'readonly':[('state','not in',['draft','confirmed'])]}"/>
                            <field name="request_type" attrs="{'readonly':[('state','not in',['draft','confirmed'])]}" options="{'no_create': True}"/>
                            <field name="product_type" attrs="{'readonly':[('state','not in',['draft','confirmed'])]}"/>
                        </group>
                        <group>
                            <field name="request_date" attrs="{'readonly':[('state','not in',['draft','confirmed'])]}"/>
                            <field name="due_date" attrs="{'readonly':[('state','not in',['draft','confirmed'])]}"/>
                            <field name="department_id" attrs="{'readonly':[('state','not in',['draft','confirmed'])]}"/>
                            <field name="ref_no" attrs="{'readonly':[('state','not in',['draft','confirmed'])]}"/>
                            <field name="check_access_role" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Product List" name="product_list_page">
                            <field name="product_line_ids" attrs="{'readonly':[('state','not in',['draft','confirmed','new_product', 'waiting_approve'])]}">
                            <!-- <field name="product_line_ids"> -->
                                <tree string="Product List">
                                    <field name="product_name" attrs="{'column_invisible': [('parent.state','in', ['done'])]}"/>
                                    <field name="product_id" attrs="{'column_invisible': [('parent.state','in', ['draft','confirmed','waiting_approve','new_product'])]}"/>
                                    <field name="demand_qty"/>
                                    <field name="uom_id"/>
                                    <field name="remark"/>
                                    <field name="design_icon"/>
                                    <field name="default_code" invisible="1"/>
                                    <field name="categ_id" invisible="1"/>
                                    <field name="barcode" invisible="1"/>
                                    <field name="list_price" invisible="1"/>
                                    <field name="standard_price" invisible="1"/>
                                    <field name="bom_component" invisible="1"/>
                                </tree>
                                <form string="Product">
                                    <group>
                                        <group>
                                            <field name="state" invisible="1"/>
                                            <field name="product_id" attrs="{'invisible':[('product_id','=',False)]}"/>
                                            <field name="product_name"/>
                                            <field name="categ_id"/>
                                            <field name="barcode"/>
                                            <field name="default_code" />
                                            <field name="list_price" attrs="{'invisible': [('parent.check_access_role', 'in', ['user','admin'])]}"/>
                                            <field name="sale_price_marketing" attrs="{'invisible': [('parent.check_access_role', 'in', ['user','admin'])]}" />
                                            <field name="discount_sale_price_marketing" invisible="1" />
                                            <field name="sale_price_a" attrs="{'invisible': [('parent.check_access_role', 'in', ['user','admin'])]}" />
                                            <field name="sale_price_b" attrs="{'invisible': [('parent.check_access_role', 'in', ['user','admin'])]}" />
                                        </group>
                                        <group>
                                            <field name="uom_id"/>
                                            <field name="demand_qty"/>
                                            <field name="design_icon"/>
                                            <field name="ref_item_fac" />
                                            <field name="remark"/>
                                            <field name="standard_price" attrs="{'invisible': [('parent.check_access_role', 'in', ['user','admin'])]}"/>
                                            <field name="standard_price_lp" attrs="{'invisible': [('parent.check_access_role', 'in', ['user','admin'])]}"/>
                                        </group>
                                    </group>
                                    <notebook>
                                        <!-- โรงงาน -->
                                        <page string="Product BOM" name="product_list_page" attrs="{'invisible': [('parent.check_access_role', 'in', ['user','access'])]}">
                                            <field name="bom_component" attrs="{'readonly': [('parent.state', 'not in', ['waiting_approve'])]}">
                                                <tree string="Product BOM" editable="bottom">
                                                    <field name="product_id"/>
                                                    <field name="product_qty"/>
                                                    <field name="uom_id"/>
                                                </tree>
                                            </field>
                                        </page>
                                        <!-- ลาดพร้าว -->
                                        <page string="Product BOM" name="product_list_page" attrs="{'invisible': [('parent.check_access_role', 'not in', ['user','access'])]}">
                                            <field name="bom_component" readonly="1">
                                                <tree string="Product BOM" editable="bottom">
                                                    <field name="product_id"/>
                                                    <field name="product_qty"/>
                                                    <field name="uom_id"/>
                                                </tree>
                                            </field>
                                        </page>

                                        <page string="Manufactory Price" name="manufactory_price_page" attrs="{'invisible': [('parent.check_access_role', 'in', ['user','access'])]}">
                                            <group>
                                                <group>
                                                    <field name="factory_price"/>
                                                </group>
                                                <group>
                                                   
                                                </group>
                                            </group>
                                       
                                        </page>
                                        <page string="Discount" name="discount_page" attrs="{'invisible': [('parent.check_access_role', 'in', ['user','admin'])]}">
                                            <group>
                                                <group>
                                                    <field name="triple_discount"/>
                                                </group>
                                                <group>
                                                   
                                                </group>
                                            </group>
                                       
                                        </page>
                                    </notebook>
                                </form>
                            </field>
                        </page>
                        <page string="Other info" name="other_page">
                            <group>
                                <field name="quotation_id" invisible="1"/>
                                <!-- <field name="location_dest_id"/>
                                <label for="design_group"/>
                                <div name="design_group_div" class="o_row">
                                    <field name="design_group" /> &amp;nbsp; &amp;nbsp; &amp;nbsp;
                                    <button name="action_open_url_design" type="object" class="btn btn-outline-info" string="Go To URL" attrs="{'invisible': [ (('design_group', '=', False))]}"/>
                                </div> -->
                                <field name="remark" attrs="{'readonly':[('state','not in',['draft','confirmed'])]}"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>
    <record id="mrp_pdr_action" model="ir.actions.act_window">
        <field name="name">Product Design Request</field>
        <field name="res_model">mrp.pdr</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="mrp_pdr_to_mr_view_inherited" model="ir.ui.view">
        <field name="name">mrp.mr.view.inherited</field>
        <field name="model">mrp.mr</field>
        <field name="inherit_id" ref="hdc_mrp_mr.mrp_mr_view_form" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='remark']" position="after">
                <field name="pdr_id" />
            </xpath>
        </field>
    </record>
</odoo>
