<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="view_temp_credit_request_tree" model="ir.ui.view">
        <field name="name">temp.credit.request.tree</field>
        <field name="model">temp.credit.request</field>
        <field name="arch" type="xml">
            <tree string="Temp Credit Request">
                <field name="name"/>
                <field name="partner_id"/>
                <field name="order_no"/>
                <field name="amount_total" string="Total Sales"/>
                <field name="credit_remain"/>
                <field name="sale_person"/>
                <field name="sale_team_id"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record id="view_temp_credit_request_form" model="ir.ui.view">
        <field name="name">temp.credit.request.form</field>
        <field name="model">temp.credit.request</field>
        <field name="arch" type="xml">
            <form string="Temp Credit Request">
                <header>
                    <button name="action_confirm" string="Sent to Approval" type="object" states="draft"/>
                    <button name="action_approval" string="Approve" class="btn btn-success" type="object" states="waiting_approval" groups="hdc_creditlimit_saleteam.group_credit_request_manager"/>
                    <button name="action_cancel" states="draft,approved" class="btn btn-danger" type="object" string="Cancel" groups="hdc_creditlimit_saleteam.group_credit_request_manager"/>
                    <button name="action_cancel" states="waiting_approval" class="btn btn-danger" type="object" string="Reject" groups="hdc_creditlimit_saleteam.group_credit_request_manager"/>
                    <button name="print_credit_limit_request_report" class="btn-primary" type="object" string="Print Credit Request" groups="hdc_creditlimit_saleteam.group_credit_request_manager"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,waiting_approval,approved"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="preview_invoices"
                            type="object"
                            class="oe_stat_button" icon="fa-file-text-o">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">Invoiced Credit Limits</span>
                            </div>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name"/>
                        </h1>
                    </div>
                    <group name="group_1">
                        <group name="form_1_1">
                            <field name="create_date" readonly="1"/>
                            <field name="partner_id" attrs="{'readonly': [('state', 'in', ('approved', 'cancel'))]}"/>
                            <field name="customer_credit_limit" readonly="1"/>
                            <field name="order_no" attrs="{'readonly': [('state', 'in', ('approved', 'cancel'))]}"/>
                        </group>
                        <group name="form_1_2">
                            <field name="sale_team_id" attrs="{'readonly': [('state', 'in', ('approved', 'cancel'))]}"/>
                            <field name="sale_person" attrs="{'readonly': [('state', 'in', ('approved', 'cancel'))]}"/>
                            <field name="approve_date" readonly="1"/>
                            <field name="approve_user_id" readonly="1"/>
                        </group>
                    </group>
                    <group name="group_2">
                        <group name="form_2_1" string="Credit Limit Team">
                            <field name="credit_limit" string="Team Credit Limit" readonly="1"/>
                            <field name="credit_remain" string="Team Credit Remain" readonly="1"/>
                        </group>
                        <group name="form_2_2" string="Current Credit Limit">
                            <field name="quotation_credit_limit"/>
                            <field name="invoice_credit_limit"/>
                            <field name="temp_credit_value"/>
                            <field name="team_temp_credit_value"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Order List" name="credit_line">
                            <field
                                name="order_line"
                                widget="section_and_note_one2many"
                                mode="tree">
                                <tree string="Sales Order Lines" editable="bottom">
                                    <field name="product_id"/>
                                    <field name="name"/>
                                    <field name="product_uom_qty"/>
                                    <field name="product_uom"/>
                                    <field name="price_unit"/>
                                    <field name="tax_id"/>
                                    <field name="price_subtotal"/>
                                </tree>
                            </field>
                            <group name="note_group" col="6" class="mt-2 mt-md-0">
                                <group colspan="4" string="Reason Credit Approval">
                                    <field name="reason_approval" nolabel="1" placeholder="Reason Credit Approval"/>
                                </group>
                                <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_total">
                                    <field name="amount_untaxed" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                    <field name="amount_tax" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                    <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                        <label for="amount_total" />
                                    </div>
                                    <field name="amount_total" nolabel="1" class="oe_subtotal_footer_separator" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                </group>
                                <div class="oe_clear"/>
                            </group>
                        </page>
                        <page string="TCR History" name="tcr_history_line">
                            <field name="temp_credit_history_line">
                                <tree string="Sales Order Lines" create="0" editable="bottom" delete="0">
                                    <field name="temp_credit_id" invisible="1"/>
                                    <field name="approve_sequence" readonly="1" force_save="1"/>
                                    <field name="approve_date" readonly="1" force_save="1"/>
                                    <field name="approve_amount" readonly="1" force_save="1"/>
                                    <field name="note"/>
                                </tree>
                            </field>
                            <group name="temp_credit_history_summary">
                                <group colspan="4" name="temp_credit_history_summary_left">
                                    
                                </group>
                                <group class="oe_right" name="temp_credit_history_summary_right">
                                    <label for="so_invoice_amount"/>
                                    <div class="oe_inline">
                                        <field name="so_invoice_amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                    </div>
                                    <label for="remain_amount"/>
                                    <div class="oe_inline">
                                        <field name="remain_amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                    </div>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
              </form>
        </field>
    </record>

    <record id="view_temp_credit_request_history_tree" model="ir.ui.view">
        <field name="name">temp.credit.request.history.tree.readonly</field>
        <field name="model">temp.credit.request.history</field>
        <field name="arch" type="xml">
            <tree create="0" edit="0" delete="1" import="true">
                <field name="temp_credit_id"/>
                <field name="approve_sequence"/>
                <field name="approve_date"/>
                <field name="approve_amount"/>
            </tree>
        </field>
    </record>

    <record id="view_temp_credit_request_history_form" model="ir.ui.view">
        <field name="name">temp.credit.request.history.form.readonly</field>
        <field name="model">temp.credit.request.history</field>
        <field name="arch" type="xml">
            <form string="Temp Credit Request History" edit="0" create="0">
                <sheet>
                    <group>
                        <field name="temp_credit_id" readonly="1" force_save="1"/>
                        <field name="approve_sequence" readonly="1" force_save="1"/>
                        <field name="approve_date" readonly="1" force_save="1"/>
                        <field name="approve_amount" readonly="1" force_save="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_temp_credit_request" model="ir.actions.act_window">
        <field name="name">Temp Credit Request</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">temp.credit.request</field>
        <field name="view_id" ref="view_temp_credit_request_tree"/>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('state', '!=', 'waiting_approval')]</field>
    </record>

    <record id="action_temp_credit_request_approval" model="ir.actions.act_window">
        <field name="name">Temp Credit Approval</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">temp.credit.request</field>
        <field name="view_id" ref="view_temp_credit_request_tree"/>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('state', '=', 'waiting_approval')]</field>
    </record>

    <record id="action_temp_credit_request_history" model="ir.actions.act_window">
        <field name="name">Temp Credit Request History</field>
        <field name="res_model">temp.credit.request.history</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_temp_credit_request_history_tree"/>
    </record>

    <record id="action_temp_credit_approve_multi" model="ir.actions.server">
        <field name="name">Approve</field>
        <field name="model_id" ref="model_temp_credit_request"/>
        <field name="state">code</field>
        <field name="binding_model_id" ref="model_temp_credit_request"/>
        <field name="binding_view_types">list</field>
        <field name="groups_id" eval="[(4, ref('hdc_creditlimit_saleteam.group_credit_request_manager'))]"/>
        <field name="code">
            if records:
                action = records.action_approval()
        </field>
    </record>

</odoo>
