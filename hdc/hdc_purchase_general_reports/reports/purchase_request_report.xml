<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="hdc_purchase_request_report_document">
        <t t-if="not o and doc">
            <t t-set="o" t-value="doc"/>
        </t>

        <t t-if="o and 'company_id' in o">
            <t t-set="company" t-value="o.company_id.sudo()"/>
        </t>
        <t t-if="not o or not 'company_id' in o">
            <t t-set="company" t-value="res_company"/>
        </t>

        <div class="header" style="font-family: KanitLight;" >
            <div class="row">
                <div class="col-2 text-left">
                    <t t-call="hdc_purchase_general_reports.report_logo_style"/>
                </div>
                <div class="col-7 text-left" style="font-size: 12.12px;">
                    <span style="font-size: 16.67px; font-weight: bold;"><t t-esc="company.name_th"/></span><br/>
                    <span style="font-size: 16.67px; font-weight: bold;"><t t-esc="company.name"/></span><br/>
                    <span style=""><t t-esc="company.street_th"/> <t t-esc="company.street2_th"/> <t t-esc="company.city_th"/> <t t-esc="company.state_th_id.name"/> <t t-esc="company.zip_th"/></span><br/>
                    <span style=""><t t-esc="company.street"/>,<t t-esc="company.street2"/>,<t t-esc="company.city"/>,<t t-esc="company.state_id.name"/>,<t t-esc="company.zip"/>,<t t-esc="company.country_id.name"/></span><br/>
                    <span style="">TEL : +<t t-esc="company.phone"/></span><span style=""> FAX : +<t t-esc="company.fax"/></span> <br/> 
                    <span style="">WEBSITE <t t-esc="company.website"/></span> / <span style="">EMAIL : <t t-esc="company.email"/></span><br/>
                    <span style="">เลขประจำตัวผู้เสียภาษี: <t t-esc="company.vat"/></span><br/>
                </div>
                <div class="col-3 text-right"  style="margin-right:0mm;margin-top:3mm">
                    <div style="font-size: 18.18px">
                        <span><strong>ใบขอสั่งซื้อ</strong></span><br/>
                        <span><strong>(Purchase Request)</strong></span><br/>
                    </div>
                    <div style="font-size: 18.18px">
                        <span>ต้นฉบับ/Original</span><br/>
                    </div>
                </div>
            </div>

            <div class="row" style="font-size: 13.64px;margin-top:3px;border-top: 1px solid black;border-bottom: 1px solid black;height: 100px">
                <div class="col-7" style="margin-top:2mm">
                    <div class="row">
                        <div class="col-3">
                            <span><strong>แผนกที่ขอซื้อ: </strong></span>
                        </div>
                        <div class="col-9">
                            <span t-if="doc.requested_by.employee_id.department_id">
                                <span t-field="doc.requested_by.employee_id.department_id.name"/>
                            </span>
                            <span t-if="not doc.requested_by.employee_id.department_id">
                                -
                            </span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-3">
                            <span><strong>ชื่อผู้ขอซื้อ: </strong></span>
                        </div>
                        <div class="col-9">
                            <span t-if="doc.requested_by">
                                <span t-field="doc.requested_by.name"/>
                            </span>
                            <span t-if="not doc.requested_by">
                                -
                            </span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-3">
                            <span><strong>เอกสารอ้างอิง: </strong></span>
                        </div>
                        <div class="col-9">
                            <span t-if="doc.origin">
                                <span t-field="doc.origin"/>
                            </span>
                            <span t-if="not doc.origin">
                                -
                            </span>
                        </div>
                    </div>
                    <!-- <div class="row">
                        <div class="col-5">
                            <span><strong>รายละเอียด: </strong></span>
                        </div>
                        <div class="col-7">
                            <span t-if="doc.description and len(doc.description) &gt; 70">
                                <span t-esc="doc.description[:70] + '...'" />
                            </span>
                            <span t-if="doc.description and len(doc.description) &lt;= 70">
                                <span t-field="doc.description"/>
                            </span>
                            <span t-if="not doc.description">
                                -
                            </span>
                        </div>

                    </div> -->
        

                </div>
                <div class="col-5" style="margin-top:2mm">
                    <div class="row">
                          <div class="col-12" style="background-color:#ECECEC">
                            <div class="row">
                                <div class="col-4">
                                    <span><strong>วันที่:</strong></span>
                                </div>
                                <div class="col-8">
                                   <span t-if="doc.date_start">
                                        <span t-field="doc.date_start" t-options='{"format": "dd/MM/yyyy"}'/>
                                    </span>
                                    <span t-if="not doc.date_start">
                                        -
                                    </span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-4">
                                    <span><strong>เลขที่ใบขอซื้อ:</strong></span>
                                </div>
                                <div class="col-8">
                                    <span t-if="doc.name">
                                        <span t-field="doc.name"/>
                                    </span>
                                    <span t-if="not doc.name">
                                        -
                                    </span>
                                </div>
                                <!-- <div class="col-7">
                                   <span t-if="doc.date_approve">
                                        <span t-field="doc.date_approve" t-options='{"format": "dd/MM/yyyy"}'/>
                                    </span>
                                    <span t-if="not doc.date_approve">
                                        -
                                    </span>
                                </div> -->
                            </div>
                            <div class="row">
                                <div class="col-4">
                                    <span><strong>วันที่ต้องการ:</strong></span>
                                </div>
                                <div class="col-8">
                                    <span t-if="doc.request_date">
                                        <t t-esc="doc.request_date.strftime('%d/%m/%Y')"/>
                                    </span>
                                    <span t-if="not doc.request_date">
                                    -
                                    </span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-4">
                                    <span><strong>วันที่หมดอายุ:</strong></span>
                                </div>
                                <div class="col-8">
                                    <span t-if="doc.expire_date">
                                        <span t-field="doc.expire_date" t-options='{"format": "dd/MM/yyyy"}'/>
                                    </span>
                                    <span t-if="not doc.expire_date">
                                        -
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="article" style="font-family: KanitLight;" t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id">
            <div class="row" >
                <div style="padding-left: 5px;padding-right: 5px;height: 500px">
                    <t t-set="l_no" t-value="0"/>
                    <table class="table" style="font-size: 13.64px;line-height: 18px">
                        <thead style="background-color:#ECECEC">
                            <tr>
                                <th class="text-center" style="width: 6%;">ลำดับ</th>
                                <th class="text-center" style="width: 14%;">รหัสสินค้า</th>
                                <th class="text-center" style="width: 17%;">รายละเอียด</th>
                                <th class="text-center" style="width: 10%;">สินค้าในสต็อก</th>
                                <th class="text-center" style="width: 8%;">หน่วย</th>
                                <th class="text-center" style="width: 10%;">คำสั่งซื้อค้างส่ง</th>
                                <th class="text-center" style="width: 8%;">หน่วย</th>
                                <th class="text-center" style="width: 10%;">จำนวนที่ต้องการสั่งซื้อ</th>
                                <th class="text-center" style="width: 8%;">หน่วย</th>
                                <th class="text-center" style="width: 10%;">จำนวนที่อนุมัติให้สั่งซื้อ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-set="set_no_vat" t-value="0"/>
                            <t t-set="set_vat" t-value="0"/>
                            <t t-set="set_dis" t-value="0"/>
                            <tr t-foreach="o.line_ids" t-as="ol">
                            
                                <td class="text-center">
                                    <t t-set="l_no" t-value="l_no + 1"/>
                                    <t t-esc="l_no"/>
                                </td>
                                <td class="text-left">
                                    <span t-if="ol.product_id.default_code">
                                        <span t-field="ol.product_id.default_code"/>
                                    </span>
                                    <span t-if="not ol.product_id.default_code">
                                        <div class="text-center">
                                            -
                                        </div>
                                    </span>
                                </td>
                                <!-- <td class="text-left">
                                    <span t-if="ol.product_id.name">
                                        <span t-field="ol.product_id.name"/>
                                    </span>
                                    <span t-if="not ol.product_id.name">
                                        <div class="text-center">
                                            -
                                        </div>
                                    </span>
                                </td> -->
                                <td class="text-left">
                                    <span t-if="ol.product_id.description_purchase">
                                        <span t-field="ol.product_id.description_purchase"/>
                                    </span>
                                    <span t-if="not ol.product_id.description_purchase">
                                        <div class="text-center">
                                            -
                                        </div>
                                    </span>
                                </td>
                                <td class="text-center" >
                                    <span t-if="ol.product_id.qty_available">
                                        <span t-field="ol.product_id.qty_available"/>
                                    </span>
                                    <span t-if="not ol.product_id.qty_available">
                                        0.00
                                    </span>
                                </td>
                                <td class="text-center" >
                                    <span t-if="ol.product_id.uom_id">
                                        <span t-field="ol.product_id.uom_id"/>
                                    </span>
                                    <span t-if="not ol.product_id.uom_id">
                                        -
                                    </span>
                                </td>
                                <td class="text-center" >
                                    <span t-if="ol.pending_order">
                                        <span t-esc="'{0:,.2f}'.format(ol.pending_order)"/>
                                    </span>
                                    <span t-if="not ol.pending_order">
                                        0.00
                                    </span>
                                </td>
                                <td class="text-center" >
                                    <span t-if="ol.product_id.uom_id">
                                        <span t-field="ol.product_id.uom_id"/>
                                    </span>
                                    <span t-if="not ol.product_id.uom_id">
                                        -
                                    </span>
                                </td>
                                <td class="text-center" >
                                    <span t-if="ol.product_qty">
                                        <span t-esc="'{0:,.2f}'.format(ol.product_qty)"/>
                                    </span>
                                    <span t-if="not ol.product_qty">
                                        0.00
                                    </span>
                                </td>
                                <td class="text-center" >
                                    <span t-if="ol.product_uom_id">
                                        <span t-field="ol.product_uom_id"/>
                                    </span>
                                    <span t-if="not ol.product_uom_id">
                                        -
                                    </span>
                                </td>
                                <td class="text-center" >
                                    <span t-if="ol.approve_order">
                                        <span t-field="ol.approve_order"/>
                                    </span>
                                    <span t-if="not ol.approve_order">
                                        
                                    </span>
                                </td>
                            
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

         <div class="footer last-page not-first-page" style="font-size: 11px;font-family: KanitLight;;overflow: hidden;max-height:403px;overflow: hidden;">
        
                <div class="row" style="font-size: 13.64px;border-top: 1px solid black; border-bottom: 1px solid black;max-height:200px;overflow: hidden;">
                    <br/>
                    <div class="col-9">
                        <div class="col-12">
                            <div class="text-left">
                                <span><strong>หมายเหตุ: </strong></span>
                                <span t-if="doc.description and len(doc.description) &gt; 90">
                                    <span t-esc="doc.description[:90] + '...'" />
                                </span>
                                <span t-if="doc.description and len(doc.description) &lt;= 90">
                                    <span t-field="doc.description"/>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="col-12">
                            <div class="text-right">
                                <t t-set="total_order_plan" t-value="sum(line.product_qty for line in doc.line_ids)" />
                                <!-- <t t-set="total_after_discount" t-value="total_before_tax - discount_total" /> -->
                                <span>รวม: </span> <span t-esc="'{0:,.2f}'.format(total_order_plan)"/>
                                
                            </div>
                        </div>
                    </div>

        
                </div>
                <br/>
                <div class="row">
                    <br/>
                    <div class="col-4" align="center">
                        <br/>
        
                        <div>ผู้ขอซื้อ</div>
                        <br/>
                        <div style="position: relative;">
                            <div style="position: absolute; top: -7px; width: 100%; text-align: center;">
                                <!-- <span t-field="doc.requested_by.employee_id.signature"/> -->
                                <img t-if="doc.requested_by.employee_id.signature" t-att-src="'data:image/png;base64,' + doc.requested_by.employee_id.signature.decode('utf-8')" style="max-height: 100px; max-width: 100px;"/>

                            </div>
                            <div class="col-8" style="border-bottom: 1px solid black">&#160;</div>
                        </div>
                        <br/>
                        <div style="position: relative;">
                            <div style="position: absolute; top: -7px; width: 100%; text-align: center;">
                                <span t-field="doc.date_start" t-options='{"format": "dd/MM/yyyy"}'/>
                            </div>
                            <div>วันที่.................................................................&#160;</div>
                        </div>
                    </div>
                    <div class="col-4" align="center">
                        <br/>
        
                        <div>หัวหน้าแผนก</div>
                        <br/>
                        <div style="position: relative;">
                            <div style="position: absolute; top: -7px; width: 100%; text-align: center;">
                                <!-- <span t-field="doc.review_ids.done_by.employee_id.signature"/> -->
                                <img t-if="doc.review_ids.done_by.employee_id.signature" t-att-src="'data:image/png;base64,' + doc.review_ids.done_by.employee_id.signature.decode('utf-8')" style="max-height: 100px; max-width: 100px;"/>
                            </div>
                            <div class="col-8" style="border-bottom: 1px solid black">&#160;</div>
                        </div>
                        <br/>
                        <div style="position: relative;">
                            <div style="position: absolute; top: -7px; width: 100%; text-align: center;">
                                <!-- <span t-field="doc.review_ids.reviewed_date" t-options='{"format": "dd/MM/yyyy"}'/> -->
                                <span t-if="doc.review_ids" t-field="doc.review_ids.sorted(key=lambda r: r.reviewed_date)[-1].reviewed_date" t-options='{"format": "dd/MM/yyyy"}'/>
                            </div>
                            <div>วันที่.................................................................&#160;</div>
                        </div>
                    </div>
                    <div class="col-4" align="center">
                        <br/>

                        <div>ผู้อนุมัติ</div>
                        <br/>
                        <div style="position: relative;">
                            <div style="position: absolute; top: -7px; width: 100%; text-align: center;">
                                <!-- <span t-field="doc.review_ids.done_by.name"/> -->
                            </div>
                            <div class="col-8" style="border-bottom: 1px solid black">&#160;</div>
                        </div>
                        <br/>
                        <div style="position: relative;">
                            <div style="position: absolute; top: -7px; width: 100%; text-align: center;">
                                <!-- <span t-field="doc.review_ids.reviewed_date" t-options='{"format": "dd/MM/yyyy"}'/> -->
                            </div>
                            <div>วันที่.................................................................&#160;</div>
                        </div>
                    </div>

            
                </div>
                <div class="row">
                <div class="col-12 text-right"  style="margin-right:0mm;margin-top:3mm">
                    <div style="font-size: 11px" >
                        <t t-set="check_iso" t-value="'hdc_purchase_general_reports.hdc_purchase_request_report_th'"/>
                        <span>
                            <span t-esc="doc.check_iso_name(check_iso)"/>
                        </span>

                    </div>
                </div>
            </div>
            
            <br/>

        </div>
    </template>

    <template id="hdc_purchase_request_report_th">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="hdc_purchase_general_reports.hdc_purchase_request_report_document" />
            </t>
        </t>
    </template>

</odoo>